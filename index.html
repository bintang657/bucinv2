<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Untuk Keyren</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&family=Playfair+Display:ital,wght@1,600&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        maroon: '#800000',
                        'maroon-light': '#a52a2a',
                        'blue-dark': '#0b1121', 
                        'blue-accent': '#38bdf8',
                    },
                    fontFamily: {
                        sans: ['Poppins', 'sans-serif'],
                        serif: ['Playfair Display', 'serif'],
                    }
                }
            }
        }
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        #canvas-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: -1;
            background: linear-gradient(to bottom, #0b1121, #1e3a5f);
        }
        .floating-element {
            animation: float 6s ease-in-out infinite;
        }
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
    </style>
</head>
<body class="text-white font-sans antialiased overflow-x-hidden">

    <div id="canvas-container"></div>

    <main class="min-h-screen flex flex-col items-center justify-center p-6 relative">
        <div class="text-center bg-blue-dark/60 p-10 rounded-3xl backdrop-blur-md border border-maroon/50 shadow-2xl shadow-maroon/20 floating-element max-w-lg w-full mt-20">
            <h1 class="text-5xl md:text-6xl font-serif text-transparent bg-clip-text bg-gradient-to-r from-maroon-light to-blue-accent mb-4">
                Hai, Keyren
            </h1>
            <p class="text-blue-accent/80 text-lg mb-8">
                Gulir ke bawah untuk membaca pesanku. üëá
            </p>
        </div>
    </main>

    <section class="py-20 px-6 max-w-2xl mx-auto relative z-10 min-h-[50vh]">
        <div class="bg-gradient-to-br from-maroon/90 to-maroon-light/90 p-8 rounded-2xl shadow-lg border border-maroon-light transform hover:scale-105 transition duration-300">
            <h2 class="text-2xl font-bold mb-4 flex items-center gap-2">
                üíå <span class="text-white">Pesan Untukmu</span>
            </h2>
            <p id="secret-message" class="text-lg italic text-white/90 leading-relaxed">
                Memuat pesan rahasia... ‚è≥
            </p>
        </div>
    </section>

    <button id="btn-kangen" class="fixed bottom-6 right-6 z-50 bg-maroon hover:bg-maroon-light text-white rounded-full p-4 shadow-lg shadow-maroon/50 flex items-center gap-2 transition-all transform hover:scale-110 group">
        <span class="text-2xl animate-pulse">‚ù§Ô∏è</span>
        <span class="hidden group-hover:inline-block font-semibold pr-2 whitespace-nowrap">Aku Kangen!</span>
    </button>

    <script>
        const init3D = () => {
            const container = document.getElementById('canvas-container');
            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
            
            renderer.setSize(window.innerWidth, window.innerHeight);
            container.appendChild(renderer.domElement);

            const particlesGeometry = new THREE.BufferGeometry();
            const particlesCount = 150; 
            const posArray = new Float32Array(particlesCount * 3);
            const colorsArray = new Float32Array(particlesCount * 3);

            const colorMaroon = new THREE.Color('#a52a2a');
            const colorBlue = new THREE.Color('#38bdf8');

            for(let i = 0; i < particlesCount * 3; i+=3) {
                posArray[i] = (Math.random() - 0.5) * 15;
                posArray[i+1] = (Math.random() - 0.5) * 15;
                posArray[i+2] = (Math.random() - 0.5) * 10;

                const mixedColor = Math.random() > 0.5 ? colorMaroon : colorBlue;
                colorsArray[i] = mixedColor.r;
                colorsArray[i+1] = mixedColor.g;
                colorsArray[i+2] = mixedColor.b;
            }

            particlesGeometry.setAttribute('position', new THREE.BufferAttribute(posArray, 3));
            particlesGeometry.setAttribute('color', new THREE.BufferAttribute(colorsArray, 3));

            const material = new THREE.PointsMaterial({ size: 0.05, vertexColors: true, transparent: true, opacity: 0.8 });
            const particlesMesh = new THREE.Points(particlesGeometry, material);
            scene.add(particlesMesh);
            camera.position.z = 5;

            let mouseX = 0, mouseY = 0, targetX = 0, targetY = 0;
            const windowHalfX = window.innerWidth / 2, windowHalfY = window.innerHeight / 2;

            document.addEventListener('mousemove', (event) => {
                mouseX = (event.clientX - windowHalfX);
                mouseY = (event.clientY - windowHalfY);
            });

            const animate = () => {
                requestAnimationFrame(animate);
                targetX = mouseX * 0.001;
                targetY = mouseY * 0.001;
                particlesMesh.rotation.y += 0.002;
                particlesMesh.rotation.x += 0.001;
                particlesMesh.rotation.y += 0.05 * (targetX - particlesMesh.rotation.y);
                particlesMesh.rotation.x += 0.05 * (targetY - particlesMesh.rotation.x);
                renderer.render(scene, camera);
            };
            animate();

            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            });
        };
        window.onload = init3D;
    </script>

    <script type="module">
        // Import Firebase dari CDN
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, doc, getDoc, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        // TODO: GANTI INI DENGAN KONFIGURASI FIREBASE MILIKMU NANTI
        const firebaseConfig = {
            apiKey: "API_KEY_KAMU",
            authDomain: "PROJECT_ID.firebaseapp.com",
            projectId: "PROJECT_ID",
            storageBucket: "PROJECT_ID.appspot.com",
            messagingSenderId: "SENDER_ID",
            appId: "APP_ID"
        };

        // Inisialisasi Database
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // 1. MENGAMBIL PESAN DARI DATABASE
        async function ambilPesan() {
            try {
                // Mencari dokumen "pesan_utama" di koleksi "konten_web"
                const docRef = doc(db, "konten_web", "pesan_utama");
                const docSnap = await getDoc(docRef);

                if (docSnap.exists()) {
                    document.getElementById('secret-message').innerText = `"${docSnap.data().teks}"`;
                } else {
                    document.getElementById('secret-message').innerText = "Belum ada pesan baru dari pembuat web ini.";
                }
            } catch (error) {
                console.error("Gagal mengambil data:", error);
                document.getElementById('secret-message').innerText = "Koneksi database belum disetting dengan benar.";
            }
        }
        
        ambilPesan(); // Jalankan saat web dibuka

        // 2. MENGIRIM DATA SAAT TOMBOL KANGEN DITEKAN
        document.getElementById('btn-kangen').addEventListener('click', async () => {
            
            // Efek visual Confetti
            confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 }, colors: ['#800000', '#38bdf8', '#ffffff'] });

            try {
                // Menyimpan catatan ke database bahwa tombol ditekan
                await addDoc(collection(db, "interaksi_kangen"), {
                    pengirim: "Keyren",
                    waktu: serverTimestamp()
                });

                Swal.fire({
                    title: 'Terkirim! üöÄ',
                    text: 'Notifikasi kangen kamu udah masuk ke database!',
                    icon: 'success',
                    confirmButtonText: 'Tutup',
                    confirmButtonColor: '#800000',
                    background: '#0b1121',
                    color: '#fff'
                });
            } catch (error) {
                console.error("Gagal mengirim:", error);
                Swal.fire({
                    title: 'Oops!',
                    text: 'Gagal mengirim ke database. Cek koneksi Firebase-mu.',
                    icon: 'error',
                    confirmButtonColor: '#800000'
                });
            }
        });
    </script>
</body>
</html>
